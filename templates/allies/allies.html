{% extends "base.html" %}
{% block head_title %}Allies{% endblock %}
{% load static %}
{% load mathfilters %}
{% block content %}
<section class="tab-content">
<div class="flib">
    <form action="{% url 'allies' %}">
        <span>
          <input class="submissions" type="text" placeholder="Owner" aria-label="current_owner"
            name='current_owner' value='{{ request.GET.current_owner }}'>
          <input class="submissions" inputmode="numeric" type="number" placeholder="Cost" aria-label="cost" name='cost'
            value='{{ request.GET.cost }}'>
          <input class="submissions" type="text" placeholder="Clan" aria-label="clan" name='clan'
            value='{{ request.GET.clan }}'>
        <input type="submit" value="Search"></span>
    </form>
  </div>
  <br />
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Ally Name</th>
        <th scope="col">Clan</th>
        <th scope="col">Cost</th>
        <th scope="col">G/L</th>
        <th scope="col">B/L</th>
        <th scope="col">S/L</th>
        <th scope="col">Total</th>
        <th scope="col">Owned By</th>
      </tr>
    </thead>
    <tbody>
      {% for ally in allies %}
      <tr>
        <td data-th="Ally"><a href="{% url 'allies' %}?current_owner={{ally.username}}">{{ally.username}}</a>
          {% if ally.owned_allies__count %} ({{ ally.owned_allies__count }}){% endif %}</td>
        <td data-th="Clan"><a href="{% url 'allies' %}?clan={{ally.group_tag}}">{{ally.group_tag}}</a></td>
        <td data-th="Cost"><a href="{% url 'allies' %}?cost={{ally.cost}}">{{ally.cost}}</a></td>
        <td data-th="G/L">{{ally.biome3_attack_multiplier|div:100}}%</td>
        <td data-th="B/L">{{ally.biome4_attack_multiplier|div:100}}%</td>
        <td data-th="S/L">{{ally.biome5_attack_multiplier|div:100}}%</td>
        <td data-th="Total">
          {{ally.biome3_attack_multiplier|add:ally.biome4_attack_multiplier|add:ally.biome5_attack_multiplier|div:100}}%
        </td>
        <td data-th="Owned By"><a
            href="{% url 'allies' %}?current_owner={{ally.owner.username}}">{{ally.owner.username}}</a></td>
      </tr>
      {% empty %}
      <tr>
        <td>No match</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <nav aria-label="pagination">
    <div class="pagination-wrapper">
      <div class="pagination">
        {% if page_obj.has_previous %}
        <a class="prev page-numbers"
          href="?page=1{% if request.GET.cost %}&cost={{ request.GET.cost }}{% endif %}{% if request.GET.clan %}&clan={{ request.GET.clan }}{% endif %}{% if request.GET.current_owner %}&current_owner={{ request.GET.current_owner }}{% endif %}">&laquo;
          First</a>
        <a class="prev page-numbers"
          href="?page={{ page_obj.previous_page_number }}{% if request.GET.cost %}&cost={{ request.GET.cost }}{% endif %}{% if request.GET.clan %}&clan={{ request.GET.clan }}{% endif %}{% if request.GET.current_owner %}&current_owner={{ request.GET.current_owner }}{% endif %}">Prev</a>
        {% else %}
        <a class="prev page-numbers disabled" href="" tabindex="-1">&laquo; First</a>
        <a class="prev page-numbers disabled" href="" tabindex="-1">Prev</a>
        {% endif %}
        <a class="page-numbers disabled" href="" tabindex="-1">Page {{ page_obj.number }} of
          {{ page_obj.paginator.num_pages }}</a>
        {% if page_obj.has_next %}
        <a class="next page-numbers"
          href="?page={{ page_obj.next_page_number }}{% if request.GET.cost %}&cost={{ request.GET.cost }}{% endif %}{% if request.GET.clan %}&clan={{ request.GET.clan }}{% endif %}{% if request.GET.current_owner %}&current_owner={{ request.GET.current_owner }}{% endif %}">Next</a>
        <a class="next page-numbers"
          href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.cost %}&cost={{ request.GET.cost }}{% endif %}{% if request.GET.clan %}&clan={{ request.GET.clan }}{% endif %}{% if request.GET.current_owner %}&current_owner={{ request.GET.current_owner }}{% endif %}">Last
          &raquo;</a>
        {% else %}
        <a class="next page-numbers disabled" href="" tabindex="-1">Next</a>
        <a class="next page-numbers disabled" href="" tabindex="-1">Last &raquo;</a>
        {% endif %}
      </div>
    </div>
  </nav>
</section>
  {% endblock %}